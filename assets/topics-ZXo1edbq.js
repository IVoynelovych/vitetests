import{c as y}from"./changetorigistrated-B8TaOUy0.js";import"./main-UIHQNVnb.js";const k="https://harry-potter-test-preparation-backend.onrender.com/";function g(o){let r=localStorage.getItem("token");return fetch(`${k}progress/topic/${o}`,{method:"GET",headers:{Authorization:"Bearer "+r,"ngrok-skip-browser-warning":"69420","Content-Type":"application/json"}}).then(t=>{if(t.status===404)return 0;if(!t.ok)throw new Error(`HTTP Error: ${t.status}`);return t.json()}).then(t=>{localStorage.setItem("completedTasks",t.completedTasks)}).catch(t=>(console.error("Помилка при отриманні прогресу :",t),0))}const f="https://harry-potter-test-preparation-backend.onrender.com/",w=document.createElement("li");w.style.cursor="pointer";function E(o,r,t){let c=localStorage.getItem("token"),i=localStorage.getItem("completedTasks");return console.log(i),fetch(`${f}topic/tasks/${o}`,{method:"GET",headers:{Authorization:"Bearer "+c,"ngrok-skip-browser-warning":"69420","Content-Type":"application/json"}}).then(e=>{if(!e.ok)throw new Error(`HTTP Error: ${e.status}`);return e.json()}).then(e=>{r.innerHTML="",e.forEach(n=>{const a=document.createElement("li");a.textContent=`${n.condition}`,a.setAttribute("taskId",JSON.stringify(n._id)),a.classList.add("task_item"),a.style.cursor="pointer",a.addEventListener("click",()=>{localStorage.setItem("taskId",n._id),window.location.href="task.html"}),r.appendChild(a)});const s=document.createElement("li");s.textContent=`Тест з теми ${t}`,s.setAttribute("topicId",o),g(o),i<1&&s.classList.add("disablade"),s.addEventListener("click",()=>{localStorage.setItem("topic",o),window.location.href="test.html"}),s.classList.add("task_item"),s.style.cursor="pointer",s.style.display="block",r.appendChild(s),r.style.display="block"}).catch(e=>{console.error("Error fetching task details:",e),r.style.display="none"})}const m="https://harry-potter-test-preparation-backend.onrender.com/";function T(o){let r=localStorage.getItem("token");return fetch(`${m}progress/test/${o}`,{method:"GET",headers:{Authorization:"Bearer "+r,"ngrok-skip-browser-warning":"69420","Content-Type":"application/json"}}).then(t=>{if(console.log(`API: ${m}progress/test/${o}`),t.status===404)return 0;if(!t.ok)throw new Error(`HTTP Error: ${t.status}`);return t.json()}).then(t=>(console.log(t),t.maxScore)).catch(t=>(console.error("Помилка при отриманні прогресу :",t),0))}function b(){const o=document.createElement("div");return o.classList.add("loader"),o.textContent="Завантаження тем...",o}const _="https://harry-potter-test-preparation-backend.onrender.com/",h=document.querySelector(".topics_list");function $(o){const r=document.createElement("ul");return r.classList.add("dropdown"),r.style.display="none",r}async function I(){let o=localStorage.getItem("token");const r=b();h.appendChild(r);try{const t=await fetch(`${_}topic/`,{method:"GET",headers:{Authorization:"Bearer "+o,"ngrok-skip-browser-warning":"69420","Content-Type":"application/json"}});if(!t.ok)throw new Error(`HTTP Error: ${t.status}`);const c=await t.json();if(!c.result||c.result.length===0){console.warn("Немає доступних тем."),r.remove();return}let i=[];await Promise.all(c.result.map(async(e,s)=>{const n=document.createElement("li");n.textContent=`${e.number}. ${e.name}`,n.setAttribute("topicId",e._id),n.classList.add("topics_list_item"),n.style.cursor="pointer";const a=$(e._id);n.appendChild(a);let p=!1,u=!1;if(s>0){let d=c.result[s-1]._id;console.log(d);try{await T(d)==null&&(n.style.opacity="0.5",n.style.pointerEvents="none")}catch(l){console.error("Помилка отримання прогресу:",l)}}n.addEventListener("click",d=>{d.stopPropagation(),!u&&(p?(a.style.display="none",p=!1,document.querySelectorAll(".topics_list_item").forEach(l=>{l.style.display="block"})):(document.querySelectorAll(".topics_list_item").forEach(l=>{l!==n&&(l.style.display="none")}),u=!0,E(e._id,a,e.name).then(()=>{a.style.display="block",p=!0}).catch(l=>{console.error("Error fetching task details:",l)}).finally(()=>{u=!1})))}),i.push({number:e.number,element:n})})),i.sort((e,s)=>e.number-s.number),r.remove(),i.forEach(e=>h.appendChild(e.element))}catch(t){r.remove(),alert("Помилка завантаження"),console.error("Помилка завантаження:",t)}}document.querySelector(".topics_list");window.addEventListener("load",()=>{I(),y()});
