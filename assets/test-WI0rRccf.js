import"./changetorigistrated-k4dA9IUW.js";import{r as k,t as y,a as g,c as I,d as w,o as v,s as b}from"./createchat-DARiIhxJ.js";import"./main-DiX3ARcM.js";const T=document.querySelector(".question-elements"),p=document.querySelector(".condition"),m=document.querySelector(".test_cont"),h=document.querySelector(".all-in-auestion");function S(s,o){T.innerHTML="";const e=s[o];let n=JSON.parse(localStorage.getItem("userTestAnswers"))||[];localStorage.setItem("taskId",e._id),p.innerHTML=e.condition;const r=h.querySelector(".task-picture");if(r&&r.remove(),e.captionPicture){const c=document.createElement("img");c.setAttribute("src",e.captionPicture),c.classList.add("task-picture"),h.appendChild(c)}k(p),y(e);const a=m.querySelector(".nav-buttons");a&&m.removeChild(a);const t=document.createElement("div");t.classList.add("nav-buttons"),s.forEach((c,d)=>{const i=document.createElement("button");i.classList.add("nav-button_test"),i.setAttribute("index",d),n.some(u=>u._id===c._id)&&i.classList.add("completed"),d===o&&i.classList.add("active"),i.addEventListener("click",()=>{document.querySelectorAll(".nav-button_test").forEach(u=>u.classList.remove("active")),i.classList.add("active"),f(d)}),t.appendChild(i)}),m.appendChild(t)}const _="https://harry-potter-test-preparation-backend.onrender.com/";let l;document.querySelector(".condition");function L(){let s=localStorage.getItem("token"),o=localStorage.getItem("topic");fetch(`${_}topic/test/${o}`,{method:"GET",headers:{Authorization:"Bearer "+s,"ngrok-skip-browser-warning":"69420","Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{if(console.log("Отримані дані:",e),!Array.isArray(e)||e.length===0){console.warn("Немає доступних завдань.");return}l=e;let n=Number(localStorage.getItem("currentTaskIndex"))||0;n=Math.max(0,Math.min(n,l.length-1)),S(l,n)}).catch(e=>console.error("Помилка завантаження:",e))}function f(s){if(!l.length){console.warn("Дані ще не завантажені.");return}if(s<0||s>=l.length){console.warn("Вихід за межі завдань.");return}localStorage.setItem("currentTaskIndex",s),S(l,s)}const q="https://harry-potter-test-preparation-backend.onrender.com/";function A(){const s=localStorage.getItem("topic"),o=localStorage.getItem("token"),e=localStorage.getItem("userTestAnswers"),r={userAnswers:JSON.parse(e)};let a=JSON.stringify(r);return console.log(JSON.stringify(r)),console.log(a),fetch(`${q}answers/${s}`,{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify(r)}).then(t=>{if(!t.ok)throw new Error(`помилка HTTP: ${t.status}`);return t.json()}).then(t=>{t.score==0?(alert("Нажаль ви набрали 0 балів повторіть тему і спробуйте ще раз"),localStorage.setItem("userTestAnswers","")):t.score==t.possibleScore?(alert("Вітаємо ви виконали тест ідеально"),localStorage.setItem("userTestAnswers","")):t.score<t.possibleScore&&(alert(`Ви пройшли і отримали ${t.score} з ${t.possibleScore}`),localStorage.setItem("userTestAnswers","")),localStorage.setItem("currentTaskIndex","0"),console.log(window.location="/topics.html")}).catch(t=>{console.error("Помилка запиту:",t)})}function E(){let s=localStorage.getItem("type"),o=localStorage.getItem("taskId"),e=null;switch(s){case"options":e={selectedOptionId:localStorage.getItem("selectedOption"),_id:o,type:s};break;case"input":const t=document.querySelector(".question-input");if(!t)return;e={answer:t.value.trim(),_id:o,type:s};break;case"match":let c=localStorage.getItem("answers");if(!c)return;e={answer:JSON.parse(c),_id:o,type:s};break;default:console.error("Unknown task type:",s);return}let n=JSON.parse(localStorage.getItem("userTestAnswers"))||[],r=n.findIndex(t=>t._id===o);r!==-1?n[r]=e:n.push(e),localStorage.setItem("userTestAnswers",JSON.stringify(n));let a=document.querySelector(`.nav-button_test[index="${n.length-1}"]`);a&&a.classList.add("completed"),console.log("Ответ сохранен:",n)}const x=document.querySelector(".finish-task"),C=document.querySelector(".close-btn"),N=document.querySelector(".delete-chat-btn"),O=document.querySelector(".chat-svg"),$=document.querySelector(".send-messege-btn"),J=document.querySelector(".finish-test");O.addEventListener("click",()=>{g(),(localStorage.getItem("isChatExist")=="false"||localStorage.getItem("isChatExist")==null)&&I()});N.addEventListener("click",()=>{w(),g()});window.addEventListener("load",()=>{localStorage.getItem("isChatExist")=="true"&&v()});$.addEventListener("click",()=>{b()});C.addEventListener("click",()=>{g()});window.addEventListener("load",()=>{L(),x.addEventListener("click",()=>{let s=localStorage.getItem("currentTaskIndex");E(),f(Number(s)+1)})});J.addEventListener("click",()=>{A()});
