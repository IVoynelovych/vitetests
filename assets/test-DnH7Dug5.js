import"./changetorigistrated-B8TaOUy0.js";import{r as f,t as k,a as u,c as y,d as I,o as v,s as w}from"./createchat-DtExo-xW.js";import"./main-UIHQNVnb.js";const b=document.querySelector(".question-elements"),g=document.querySelector(".condition"),d=document.querySelector(".test_cont"),m=document.querySelector(".all-in-auestion");function p(o,s){b.innerHTML="";const e=o[s];localStorage.setItem("taskId",e._id),g.innerHTML=e.condition;const n=m.querySelector(".task-picture");if(n&&n.remove(),e.captionPicture){const t=document.createElement("img");t.setAttribute("src",e.captionPicture),t.classList.add("task-picture"),m.appendChild(t)}f(g),k(e);const r=d.querySelector(".nav-buttons");r&&d.removeChild(r);const c=document.createElement("div");c.classList.add("nav-buttons"),o.forEach((t,i)=>{const a=document.createElement("button");a.classList.add("nav-button_test"),a.setAttribute("index",i),c.appendChild(a),i===s&&a.classList.add("active"),a.addEventListener("click",()=>{c.querySelectorAll(".nav-button_test").forEach(S=>S.classList.remove("active")),a.classList.add("active"),h(i)})}),d.appendChild(c)}const T="https://harry-potter-test-preparation-backend.onrender.com/";let l;document.querySelector(".condition");function _(){let o=localStorage.getItem("token"),s=localStorage.getItem("topic");fetch(`${T}topic/test/${s}`,{method:"GET",headers:{Authorization:"Bearer "+o,"ngrok-skip-browser-warning":"69420","Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{if(console.log("Отримані дані:",e),!Array.isArray(e)||e.length===0){console.warn("Немає доступних завдань.");return}l=e;let n=Number(localStorage.getItem("currentTaskIndex"))||0;n=Math.max(0,Math.min(n,l.length-1)),p(l,n)}).catch(e=>console.error("Помилка завантаження:",e))}function h(o){if(!l.length){console.warn("Дані ще не завантажені.");return}if(o<0||o>=l.length){console.warn("Вихід за межі завдань.");return}localStorage.setItem("currentTaskIndex",o),p(l,o)}const q="https://harry-potter-test-preparation-backend.onrender.com/";function E(){const o=localStorage.getItem("topic"),s=localStorage.getItem("token"),e=localStorage.getItem("userTestAnswers"),r={userAnswers:JSON.parse(e)};let c=JSON.stringify(r);return console.log(JSON.stringify(r)),console.log(c),fetch(`${q}answers/${o}`,{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json"},body:JSON.stringify(r)}).then(t=>{if(!t.ok)throw new Error(`помилка HTTP: ${t.status}`);return t.json()}).then(t=>{t.score==0?(alert("Нажаль ви набрали 0 балів повторіть тему і спробуйте ще раз"),localStorage.setItem("userTestAnswers","")):t.score==t.possibleScore?(alert("Вітаємо ви виконали тест ідеально"),localStorage.setItem("userTestAnswers","")):t.score<t.possibleScore&&(alert(`Ви пройшли і отримали ${t.score} з ${t.possibleScore}`),localStorage.setItem("userTestAnswers","")),console.log("Відповідь сервера:",t)}).catch(t=>{console.error("Помилка запиту:",t)})}function L(){console.log(localStorage.getItem("taskId"),localStorage.getItem("type"),localStorage.getItem("selectedOption"));let o=localStorage.getItem("type"),s=localStorage.getItem("taskId"),e=null;switch(o){case"options":e={selectedOptionId:localStorage.getItem("selectedOption"),_id:s,type:o};break;case"input":e={answer:document.querySelector(".question-input").value.trim(),_id:s,type:o};break;case"match":let t=localStorage.getItem("answers");if(!t)return;e={answer:JSON.parse(t),_id:s,type:o};break;default:console.error("Unknown task type:",o);return}let n=localStorage.getItem("userTestAnswers");n=n?JSON.parse(n):[];let r=n.findIndex(c=>c._id===s);r!==-1?n[r]=e:n.push(e),localStorage.setItem("userTestAnswers",JSON.stringify(n)),console.log(n)}const A=document.querySelector(".finish-task"),N=document.querySelector(".close-btn"),x=document.querySelector(".delete-chat-btn"),C=document.querySelector(".chat-svg"),O=document.querySelector(".send-messege-btn"),$=document.querySelector(".finish-test");C.addEventListener("click",()=>{u(),localStorage.getItem("isChatExist")=="false"&&y()});x.addEventListener("click",()=>{I(),u()});window.addEventListener("load",()=>{localStorage.getItem("isChatExist")=="true"&&v()});O.addEventListener("click",()=>{w()});N.addEventListener("click",()=>{u()});window.addEventListener("load",()=>{_(),A.addEventListener("click",()=>{let o=localStorage.getItem("currentTaskIndex");L(),h(Number(o)+1)})});$.addEventListener("click",()=>{E()});
