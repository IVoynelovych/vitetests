import{c as m}from"./changetorigistrated-DaB09YRK.js";import"./main-D-fKq_Y_.js";const f="https://harry-potter-test-preparation-backend.onrender.com/";function y(n){let r=localStorage.getItem("token");return fetch(`${f}progress/topic/${n}`,{method:"GET",headers:{Authorization:"Bearer "+r,"ngrok-skip-browser-warning":"69420","Content-Type":"application/json"}}).then(t=>{if(t.status===404)return 0;if(!t.ok)throw new Error(`HTTP Error: ${t.status}`);return t.json()}).then(t=>(localStorage.setItem("completedTasks",t.completedTasks),t.completedTasks)).catch(t=>(console.error("Помилка при отриманні прогресу :",t),0))}const k="https://harry-potter-test-preparation-backend.onrender.com/",g=document.createElement("li");g.style.cursor="pointer";function w(n,r,t){let l=localStorage.getItem("token");return fetch(`${k}topic/tasks/${n}`,{method:"GET",headers:{Authorization:"Bearer "+l,"ngrok-skip-browser-warning":"69420","Content-Type":"application/json"}}).then(s=>{if(!s.ok)throw new Error(`HTTP Error: ${s.status}`);return s.json()}).then(s=>{r.innerHTML="",s.forEach(a=>{const o=document.createElement("li");o.textContent=`${a.condition}`,o.setAttribute("taskId",JSON.stringify(a._id)),o.classList.add("task_item"),o.style.cursor="pointer",o.addEventListener("click",()=>{localStorage.setItem("taskId",a._id),window.location.href="task.html"}),r.appendChild(o)});const e=document.createElement("li");e.textContent=`Тест з теми ${t}`,e.setAttribute("topicId",n),y(n).then(a=>{(a==0||a==null)&&(console.log(12),e.classList.add("disablade"))}),e.addEventListener("click",()=>{localStorage.setItem("topic",n),window.location.href="test.html"}),e.classList.add("task_item"),e.style.cursor="pointer",e.style.display="block",r.appendChild(e),r.style.display="block"}).catch(s=>{console.error("Error fetching task details:",s),r.style.display="none"})}const E="https://harry-potter-test-preparation-backend.onrender.com/";function T(n){let r=localStorage.getItem("token");return fetch(`${E}progress/test/${n}`,{method:"GET",headers:{Authorization:"Bearer "+r,"ngrok-skip-browser-warning":"69420","Content-Type":"application/json"}}).then(t=>{if(t.status===404)return 0;if(!t.ok)throw new Error(`HTTP Error: ${t.status}`);return t.json()}).then(t=>t.completed).catch(t=>(console.error("Помилка при отриманні прогресу :",t),0))}function b(){const n=document.createElement("div");return n.classList.add("loader"),n.textContent="Завантаження тем...",n}const _="https://harry-potter-test-preparation-backend.onrender.com/",h=document.querySelector(".topics_list");function $(n){const r=document.createElement("ul");return r.classList.add("dropdown"),r.style.display="none",r}async function L(){let n=localStorage.getItem("token");const r=b();h.appendChild(r);try{const t=await fetch(`${_}topic/`,{method:"GET",headers:{Authorization:"Bearer "+n,"ngrok-skip-browser-warning":"69420","Content-Type":"application/json"}});if(!t.ok)throw new Error(`HTTP Error: ${t.status}`);const l=await t.json();if(!l.result||l.result.length===0){console.warn("Немає доступних тем."),r.remove();return}let s=[];await Promise.all(l.result.map(async(e,a)=>{const o=document.createElement("li");o.textContent=`${e.number}. ${e.name}`,o.setAttribute("topicId",e._id),o.classList.add("topics_list_item"),o.style.cursor="pointer";const c=$(e._id);o.appendChild(c);let d=!1,p=!1;if(a>0){let u=l.result[a-1]._id;try{let i=await T(u);(i==!1||i==null)&&(o.style.opacity="0.5",o.style.pointerEvents="none")}catch(i){console.error("Помилка отримання прогресу:",i),window.location.href="registration.html"}}o.addEventListener("click",u=>{u.stopPropagation(),!p&&(d?(c.style.display="none",d=!1,document.querySelectorAll(".topics_list_item").forEach(i=>{i.style.display="block"})):(document.querySelectorAll(".topics_list_item").forEach(i=>{i!==o&&(i.style.display="none")}),p=!0,w(e._id,c,e.name).then(()=>{c.style.display="block",d=!0}).catch(i=>{console.error("Error fetching task details:",i)}).finally(()=>{p=!1})))}),s.push({number:e.number,element:o})})),s.sort((e,a)=>e.number-a.number),r.remove(),s.forEach(e=>h.appendChild(e.element))}catch(t){r.remove(),alert("Помилка завантаження"),console.error("Помилка завантаження:",t),window.location.href="registration.html"}}document.querySelector(".topics_list");window.addEventListener("load",()=>{L(),m()});
