import"./changetorigistrated-DaB09YRK.js";import{r as k,t as y,a as g,c as I,d as w,o as v,s as b}from"./createchat-Drg5x65a.js";import"./main-D-fKq_Y_.js";const T=document.querySelector(".question-elements"),p=document.querySelector(".condition"),m=document.querySelector(".test_cont"),h=document.querySelector(".all-in-auestion");function S(t,o){T.innerHTML="";const e=t[o];let n=JSON.parse(localStorage.getItem("userTestAnswers"))||[];localStorage.setItem("taskId",e._id),p.innerHTML=e.condition;const r=h.querySelector(".task-picture");if(r&&r.remove(),e.captionPicture){const a=document.createElement("img");a.setAttribute("src",e.captionPicture),a.classList.add("task-picture"),h.appendChild(a)}k(p),y(e);const s=m.querySelector(".nav-buttons");s&&m.removeChild(s);const c=document.createElement("div");c.classList.add("nav-buttons"),t.forEach((a,d)=>{const i=document.createElement("button");i.classList.add("nav-button_test"),i.setAttribute("index",d),n.some(u=>u._id===a._id)&&i.classList.add("completed"),d===o&&i.classList.add("active"),i.addEventListener("click",()=>{document.querySelectorAll(".nav-button_test").forEach(u=>u.classList.remove("active")),i.classList.add("active"),f(d)}),c.appendChild(i)}),m.appendChild(c)}const _="https://harry-potter-test-preparation-backend.onrender.com/";let l;document.querySelector(".condition");function L(){let t=localStorage.getItem("token"),o=localStorage.getItem("topic");fetch(`${_}topic/test/${o}`,{method:"GET",headers:{Authorization:"Bearer "+t,"ngrok-skip-browser-warning":"69420","Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{if(console.log("Отримані дані:",e),!Array.isArray(e)||e.length===0){console.warn("Немає доступних завдань.");return}l=e;let n=Number(localStorage.getItem("currentTaskIndex"))||0;n=Math.max(0,Math.min(n,l.length-1)),S(l,n)}).catch(e=>console.error("Помилка завантаження:",e))}function f(t){if(!l.length){console.warn("Дані ще не завантажені.");return}if(t<0||t>=l.length){console.warn("Вихід за межі завдань.");return}localStorage.setItem("currentTaskIndex",t),S(l,t)}const q="https://harry-potter-test-preparation-backend.onrender.com/";function A(){const t=localStorage.getItem("topic"),o=localStorage.getItem("token"),e=localStorage.getItem("userTestAnswers"),r={userAnswers:JSON.parse(e)};return JSON.stringify(r),fetch(`${q}answers/${t}`,{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify(r)}).then(s=>{if(!s.ok)throw new Error(`помилка HTTP: ${s.status}`);return s.json()}).then(s=>{s.score==0?(alert("Нажаль ви набрали 0 балів повторіть тему і спробуйте ще раз"),localStorage.setItem("userTestAnswers",JSON.stringify([]))):s.score==s.possibleScore?(alert("Вітаємо ви виконали тест ідеально"),localStorage.setItem("userTestAnswers",JSON.stringify([]))):s.score<s.possibleScore&&(alert(`Ви пройшли і отримали ${s.score} з ${s.possibleScore}`),localStorage.setItem("userTestAnswers",JSON.stringify([]))),localStorage.setItem("currentTaskIndex","0"),window.location.href="/topics.html"}).catch(s=>{console.error("Помилка запиту:",s)})}function E(){let t=localStorage.getItem("type"),o=localStorage.getItem("taskId"),e=null;switch(t){case"options":e={selectedOptionId:localStorage.getItem("selectedOption"),_id:o,type:t};break;case"input":const c=document.querySelector(".question-input");if(!c)return;e={answer:c.value.trim(),_id:o,type:t};break;case"match":let a=localStorage.getItem("answers");if(!a)return;e={answer:JSON.parse(a),_id:o,type:t};break;default:console.error("Unknown task type:",t);return}let n=JSON.parse(localStorage.getItem("userTestAnswers"))||[],r=n.findIndex(c=>c._id===o);r!==-1?n[r]=e:n.push(e),localStorage.setItem("userTestAnswers",JSON.stringify(n));let s=document.querySelector(`.nav-button_test[index="${n.length-1}"]`);s&&s.classList.add("completed")}const x=document.querySelector(".finish-task"),N=document.querySelector(".close-btn"),O=document.querySelector(".delete-chat-btn"),C=document.querySelector(".chat-svg"),J=document.querySelector(".send-messege-btn"),$=document.querySelector(".finish-test");C.addEventListener("click",()=>{g(),(localStorage.getItem("isChatExist")=="false"||localStorage.getItem("isChatExist")==null)&&I()});O.addEventListener("click",()=>{w(),g()});window.addEventListener("load",()=>{localStorage.getItem("isChatExist")=="true"&&v()});J.addEventListener("click",()=>{b()});N.addEventListener("click",()=>{g()});window.addEventListener("load",()=>{L(),x.addEventListener("click",()=>{let t=localStorage.getItem("currentTaskIndex");E(),f(Number(t)+1)})});$.addEventListener("click",()=>{A()});
